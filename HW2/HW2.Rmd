---
title: "HW2"
author: "Nick McManus and Katheryn Moya"
date: "2023-04-20"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(here)
library(tidyverse)
```


### Overview

First, we created a diagram to represent our model for almond yield anomalies in response to climate. This included translating our inputs into outputs and determining which parameters will influence the relationship between the inputs and outputs. 

![Almond Yied Anomoly Conceptual Model](diagram/EDS230_HW2.jpg)


### Read in data
```{r}
clim_df <- read_table("clim.txt") %>% 
  ### remove quotes in names
  janitor::clean_names()

```


### Wrangle climate data 

Here we create a data subset with the total precipitation and absolute minimum and maximum temperatures for each month. Then, we'll form two subsets for use in the almond yield function: one with minimum February temperature and another with average January precipitation.
```{r}
### Find the absolute tmin and tmax
### as well as average precip for each month in dataset
clim_months <- clim_df %>% 
  group_by(month, year) %>% 
  summarize(tmax_max = max(tmax_c),
            tmin_min = min(tmin_c),
            precip_sum = sum(precip))


### Filter for min temps from Feb
tmin_feb <- (clim_months %>% filter(month ==2))$tmin_min 

  
### Filter for summed precip in Jan
jan_precip <- (clim_months %>% filter(month ==1))$precip_sum
```



### Run function to get yield anomalies
```{r}
### Read in function
source("compute_almond_yield.R")

### Run function with climate data
yields <- almond_yield(tmin_feb, jan_precip)

yields
```

Given the climate data from 1989-2010, we see that the maximum yield anomaly for almond crops is `r yields$max_yield`, the minimum yield anomaly is `r yields$min_yield`, and the average yield anomaly is `r yields$mean_yield`.










